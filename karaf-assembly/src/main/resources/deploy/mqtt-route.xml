<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:camel="http://camel.apache.org/schema/blueprint"
           xsi:schemaLocation="
               http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
               http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">
      <!-- AMQP configuration -->
      <bean id="jmsConnectionFactory" class="org.apache.qpid.jms.JmsConnectionFactory">
        <property name="remoteURI" value="amqp://localhost:5672" />
        <property name="username" value="admin"/>
        <property name="password" value="admin"/>
      </bean>
       
      <bean id="jmsCachingConnectionFactory" class="org.springframework.jms.connection.CachingConnectionFactory">
        <property name="targetConnectionFactory" ref="jmsConnectionFactory" />
      </bean>
       
      <bean id="jmsConfig" class="org.apache.camel.component.jms.JmsConfiguration" >
        <property name="connectionFactory" ref="jmsCachingConnectionFactory" /> 
        <property name="cacheLevelName" value="CACHE_CONSUMER" />
      </bean>    
       
      <bean id="amqp" class="org.apache.camel.component.amqp.AMQPComponent">
          <property name="configuration" ref="jmsConfig" />
      </bean>

      <!-- Route --> 
      <camelContext xmlns="http://camel.apache.org/schema/blueprint">
       <!-- Retrieve temperature value from IDS protocol, setting remote attestation to most relaxed config (for
            demo only. Use 1 in production). Forward to Data App 2 -->
        <route id="mqttDemo">
          <!-- Write into message queue -->
          <from uri="paho:wtk/#?brokerUrl=tcp://broker.hivemq.com:1883" />
          <to uri="amqp:queue:test"/>
        </route>
        <!-- Read from message queue -->
        <route id="activeMQSubscriber">
          <from uri="amqp:queue:test" />
          <log message="Received via ActiveMQ : ${body}"/>
        </route>
      </camelContext>
</blueprint>
