<?xml version="1.0" encoding="UTF-8"?>
<blueprint
    xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="
      http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
       http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">

<!-- The following block is necessary to make the camel-hdfs2 component load in Karaf. You will get "no filesystem for scheme hdfs" otherwise. -->
<bean id="hdfsOsgiHelper" class="org.apache.camel.component.hdfs2.HdfsOsgiHelper">
   <argument>
      <map>
         <entry key="file:///" value="org.apache.hadoop.fs.LocalFileSystem"  />
         <entry key="hdfs://192.168.56.101:8020/" value="org.apache.hadoop.hdfs.DistributedFileSystem" />
      </map>
   </argument>
</bean>
<bean id="hdfs2" class="org.apache.camel.component.hdfs2.HdfsComponent" depends-on="hdfsOsgiHelper" />


<!-- Completely unrelated, but this is how the contents of META-INF/MANIFEST.MF within the bundle that is created from this file can be changed -->
<!--<manifest xmlns="http://karaf.apache.org/xmlns/deployer/blueprint/v1.0.0">
    Import-Package=org.apache.hadoop.hdfs
  </manifest> -->

<!-- Class name refers to our Interceptor -->
  <bean id="myInterceptor" class="de.fhg.camel.ids.interceptor.DataFlowControlInterceptor"/>
       
  <bean id="activemq" class="org.apache.activemq.camel.component.ActiveMQComponent">
      <property name="brokerURL" value="tcp://localhost:61616"/>
      <property name="userName" value="karaf"/>
      <property name="password" value="karaf"/>
   </bean>

  <camelContext id="camel" xmlns="http://camel.apache.org/schema/blueprint">
      <route id="activemq-hdfs-route">
              <from uri="activemq:test"/>
              <log message="Copying from test-queue to foo-queue"/>
	      <to uri="activemq:foo"/> 
        <to uri="hdfs2://192.168.56.101/tmp/Outbox/test1.txt" />
      </route>
  </camelContext>

</blueprint>

