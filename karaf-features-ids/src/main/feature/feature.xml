<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<!-- 
	There is a maven plugin for automatically generating Karaf features. This works however not properly 
	and generates an overly complex feature.xml which makes Karaf hang forever.

	We thus define a simple feature.xml for the IDS Core Platform here. 
-->
<features xmlns="http://karaf.apache.org/xmlns/features/v1.2.0" name="ids-${project.version}">
	<!-- Additional repositories that are needed. Might add active-mq also if needed later -->
	<repository>mvn:org.apache.camel.karaf/apache-camel/${camel.version}/xml/features</repository>
	<repository>mvn:org.apache.cxf.karaf/apache-cxf/${cxf.version}/xml/features</repository>

	<feature name="ids" description="IDS Feature" version="${project.version}">
		<details>Feature Description for Apache Karaf including all IDS bundles. This project does not contain the code, only the feature description.</details>
		
		<bundle start-level="75">mvn:de.fhg.ids/org.checkerframework.checker-qual/1.1.0-SNAPSHOT</bundle>
		<bundle start-level="75">mvn:com.google.protobuf/protobuf-java/3.5.1</bundle>

		<!-- a slightly newer Jackson version -->
		<bundle>mvn:com.fasterxml.jackson.core/jackson-core/${jackson.version}</bundle>
		<bundle>mvn:com.fasterxml.jackson.core/jackson-annotations/${jackson.version}</bundle>
		<bundle>mvn:com.fasterxml.jackson.core/jackson-databind/${jackson.version}</bundle>
		<bundle>mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-base/${jackson.version}</bundle>
		<bundle>mvn:com.fasterxml.jackson.jaxrs/jackson-jaxrs-json-provider/${jackson.version}</bundle>
		<bundle>mvn:com.fasterxml.jackson.module/jackson-module-jaxb-annotations/${jackson.version}</bundle>
		<bundle>mvn:com.fasterxml.jackson.dataformat/jackson-dataformat-yaml/${jackson.version}</bundle>
		<bundle>mvn:org.yaml/snakeyaml/1.18</bundle>

		<!-- JNR unixsocket and its runtime dependencies --> 
		<bundle>mvn:com.github.jnr/jnr-unixsocket/${jnr-unixsocket-version}</bundle>
		<bundle>mvn:com.github.jnr/jnr-ffi/2.1.4</bundle>
		<bundle>mvn:com.github.jnr/jnr-constants/0.9.8</bundle>
		<bundle>mvn:com.github.jnr/jnr-enxio/0.16</bundle>
		<bundle>mvn:com.github.jnr/jnr-posix/3.0.35</bundle>
		<bundle>mvn:com.github.jnr/jffi/1.2.15</bundle>
		<bundle>wrap:mvn:com.github.jnr/jnr-x86asm/1.0.2</bundle>
		<!-- We need to explicitly specify the dependency to org.ow2.asm because karaf uses version 6 and we need version 5 for jnr-unixsocket -->
		<bundle>mvn:org.ow2.asm/asm/5.0.3</bundle>
		<bundle>mvn:org.ow2.asm/asm-commons/5.0.3</bundle>
		<bundle>mvn:org.ow2.asm/asm-analysis/5.0.3</bundle>
		<bundle>mvn:org.ow2.asm/asm-tree/5.0.3</bundle>
		<bundle>mvn:org.ow2.asm/asm-util/5.0.3</bundle>

		<!-- Dependencies which must be available at runtime. Can be features or bundles. -->
		<bundle start-level="75">mvn:org.apache.felix/org.apache.felix.prefs/1.1.0</bundle>
		<bundle start-level="75">mvn:com.google.code.gson/gson/2.7</bundle>
		<bundle start-level="75">mvn:de.fraunhofer.aisec/tpm2j/1.0.4</bundle>        

		<feature>war</feature>
		<feature>jetty</feature>

		<!-- REST feature provided by CXF -->
		<feature>cxf-commands</feature>
		<feature>cxf-jaxrs</feature>

		<feature>camel-jackson</feature>
		<feature>camel-milo</feature>
		<feature>camel-cxf</feature>
		<feature>camel-http</feature>
		<feature>camel-jetty</feature>
		
		<!-- for the IDS protocol -->
		<feature>camel-ahc</feature> <!-- ids-comm extends this -->
		<feature>camel-reactive-streams</feature> <!-- Could be reduced to bundle mvn:org.reactivestreams/reactive-streams/1.0.2-->
		
		<bundle>mvn:org.javassist/javassist/3.20.0-GA</bundle>
		<bundle>mvn:com.codepoetics/protonpack/1.10</bundle>
		<bundle>wrap:mvn:org.reflections/reflections/0.9.10</bundle>
		<bundle>mvn:com.google.guava/guava/${guava.version}</bundle>
		<bundle>mvn:org.jooq/jool/0.9.10</bundle>

		<bundle>mvn:io.dropwizard.metrics/metrics-core/3.1.2</bundle>

		<!-- IDS specific bundles -->
		<bundle>mvn:de.fhg.ids/ids-api/${project.version}</bundle>
		<bundle>mvn:de.fhg.ids/idscp/${project.version}</bundle>
		<bundle>mvn:de.fhg.ids/ids-container-manager/${project.version}</bundle>
		<bundle>mvn:de.fhg.ids/ids-route-manager/${project.version}</bundle>
		<bundle>mvn:de.fhg.ids/ids-dataflow-control/${project.version}</bundle>
		<bundle>mvn:de.fhg.ids/camel-ids/${project.version}</bundle>
		<bundle>mvn:de.fhg.ids/ids-webconsole/${project.version}</bundle> 
	</feature>
</features>